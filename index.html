<script>
	var propNum = 0;

	function search(key, myArray){
	    for (var i=0; i < myArray.length; i++) {
	        if (myArray[i].prop === key) {
	            return myArray[i];
	        }
	    }
	}

	function absort(iList, propIndex, valueField) {
		
		var subProp = null;
		var prop = "property" + propIndex;
		var aList = [];
		var fList = []; // Final List to return

		if (propIndex == propNum ) {
			return iList;
		}

		if (propIndex < propNum -1) {
			subProp = "property" + (propIndex+1);
		}

		for (var i=0; i<iList.length; i++) {
			var key = iList[i][prop];
			
			if (key == '$total') {
				fList.push(iList[i]);
			}
			else {
				var eleItem = search(key, aList);
				
				if (!eleItem) {
					eleItem = {prop: key, total: 0, data: []};
					eleItem.data.push(iList[i]);
					aList.push(eleItem);
				}
				else {
					eleItem.data.push(iList[i]);
				}

				if (subProp == null) {					
					eleItem.total = iList[i][valueField];					
				}
				else {
					if (iList[i][subProp] == '$total') {
						eleItem.total = iList[i][valueField];
					}	
				}
											
			}
		}

		aList.sort(function(a, b) {
		    return b.total - a.total;
		});

		// console.log(aList);
		// return;
		// assuming aList is sorted and put it to fList

		for (i=0; i<aList.length; i++) {

			var subList = absort(aList[i].data, propIndex+1, valueField);

			for (j=0; j<subList.length; j++) {
				fList.push(subList[j]);
			}
			
		}
		// console.log(aList);		
		return fList;

	}

	function main() {
		var inputField = document.getElementById("input");
		var arr = inputField.value.split("\n");
		var fields = arr[0].split("|"); // First Line contains property and values
		var iList = [];
		propNum = 0;
		
		for (var i=0; i<fields.length; i++) {
			if (fields[i].includes("property")) {
				propNum++;
			}
		}

		arr.shift(); // remove first line;
		for (i=0; i<arr.length; i++) {
			var values = arr[i].split("|");
			var ele = {};

			for (var j=0; j<fields.length; j++) {
				ele[fields[j]] = values[j];
			}

			iList.push(ele);
		}

		// console.log(iList);
		console.log(absort(iList, 0, "net_sales"));
	}
</script>
<html>
	<body style="text-align: center;">
		<textarea id="input" style="width: 80%; height: 300px;"></textarea>
		<br/><br/>
		<input type="button" value="Output" onclick="main()">
	</body>	
</html>