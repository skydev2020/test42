<script>
	var propNum = 0;

	function search(key, myArray){
	    for (var i=0; i < myArray.length; i++) {
	        if (myArray[i].prop === key) {
	            return myArray[i];
	        }
	    }
	}

	function absort(iList, propIndex, valueField) {
		
		var subProp = null;
		var prop = "property" + propIndex;
		var aList = [];
		var fList = []; // Final List to return

		if (propIndex < propNum -1) {
			subProp = "property" + (propIndex+1);
		}

		for (var i=0; i<iList.length; i++) {
			var key = iList[i][prop];
			
			if (key == '$total') {
				fList.push(iList[i]);
			}
			else {
				var eleItem = search(key, aList);
				
				if (!eleItem) {
					eleItem = {prop: key, total: 0, data: []};
					eleItem.data.push(iList[i]);
					// if (iList[i][subProp] == '$total') {
					// 	eleItem.total = iList[i][valueField];
					// }
					aList.push(eleItem);
				}
				else {
					eleItem.data.push(iList[i]);
					// if (iList[i][subProp] == '$total') {
					// 	eleItem.total = iList[i][valueField];
					// }
				}
				if (iList[i][subProp] == '$total') {
					eleItem.total = iList[i][valueField];
				}
				
							
			}
		}

		console.log(aList);
		return;
		var sortable=[];
		for(var key in aList)
			if(aList.hasOwnProperty(key))
				sortable.push([key, aList[key]]); // each item is an array in format [key, value]
		
		// sort items by value
		sortable.sort(function(a, b)
		{
			var x=a[1].total,
				y=b[1].total;
			return x<y ? 1 : x>y ? -1 : 0;
		});
		console.log(sortable);
		
		// add $total
		for (i=0; i<sortable.length; i++) {
		    fList[sortable[i][0]] = sortable[i][1];
		}


		// for (i=0; i<aList.length; i++) {
		// 	var key = iList[i][prop];
		// 	if (!aList[key]) {
		// 		aList[key] = [];				
		// 	}
		// 	aList[key].push(iList[i]);
		// }
		// console.log(aList);		
		return fList;

	}

	function main() {
		var inputField = document.getElementById("input");
		var arr = inputField.value.split("\n");
		var fields = arr[0].split("|"); // First Line contains property and values
		var iList = [];

		
		for (var i=0; i<fields.length; i++) {
			if (fields[i].includes("property")) {
				propNum++;
			}
		}

		arr.shift(); // remove first line;
		for (i=0; i<arr.length; i++) {
			var values = arr[i].split("|");
			var ele = {};

			for (var j=0; j<fields.length; j++) {
				ele[fields[j]] = values[j];
			}

			iList.push(ele);
		}

		// console.log(iList);
		console.log(absort(iList, 0, "net_sales"));
	}
</script>
<html>
	<body style="text-align: center;">
		<textarea id="input" style="width: 80%; height: 300px;"></textarea>
		<br/><br/>
		<input type="button" value="Output" onclick="main()">
	</body>	
</html>